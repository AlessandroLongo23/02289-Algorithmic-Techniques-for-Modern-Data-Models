## Streaming model (one-pass)
A stream is a sequence of elements $a_1,\ldots,a_m$ from the universe $[n]=\{1,\ldots,n\}$, that arrive one by one. We must process element $a_i$ before we see $a_{i+1}$.
![[stream.png]]
The space is measured in bits.
The goal is to analyze the stream using a small space (sublinear or polylogarithmic).
## Frequent elements
### Heavy Hitters Problems
Find all elements $i$ that occurs more than $\dfrac mk$ times for some fixed $k$.
```ad-Esempio
title: Example
![[heavy-hitters-example-1.png]]
Return all elements that occur more than $\dfrac{21}3=7$ times.

![[heavy-hitters-example-2.png]]
```
The bad news is that we need $\Omega(n)$ space for a one-pass algorithm.
But the good news is that we can estimate the frequency and can do better if we allow for a one-sided error: we will output all elements that occur more than $\dfrac mk$ times (true positives), and also might output other elements (false positives).
```ad-Esempio



```
Keep $k-1$ counters in an associative array $A$.
```
proc estimate_frequency(stream):
	while stream is not empty:
		if j in keys(A):
			A[j] = A[j] + 1
		else if |keys(A)| < k - 1:
			A[j] = 1
		else:
			decrement all counters by 1
			remove all elements with counter 0
	
	output all elements in keys(A)
```
The required space is $O(k\cdot (\log(n)+\log(m)))$
## Misra-Gries Analysis
```ad-Teorema
title: Lemma
Any item with frequency more than $\dfrac mk$ is in $A$ by the end of the algorithm.
```
```ad-Teorema
title: Lemma
Let $\hat f_i$ be the estimate of the frequency of element $i$. Then:
$$f_i-\dfrac mk\le\hat f_i\le f_i$$
```
![[Misra-gries.png]]
- - -
## Reservoir Sampling
Reservoir sampling is a method for choosing an item item uniformly at random from an arbitrarily long stream of data; for example, the sequence of packets that pass through a router, or the sequence of IP addresses that access a given web page. Like all data stream algorithms, this algorithm must process each item in the stream quickly, using very little memory.
### Algorithm
Put the first $k$ elements into a "reservoir" $R=\{r_1,r_2,\ldots,r_k\}$.
For $i\gt k$ until the stream is empty, with probability $\dfrac ki$ replace a random entry of $R$ with $a_i$.
Return $R$.
### Claim
For all $t\gt i$:
$$P[a_i\in R_t]=\dfrac kt$$
where $R_t$ denotes the reservoir after time $t$.
```ad-Dimostrazione
title: Proof
Consider element $a_i$:
- $P[a_i\text{ chosen at time }i]=\dfrac ki$
- $P[a_i\text{ replaced at time }j]=\dfrac kj\cdot\dfrac 1k=\dfrac 1j$
- $P[a_i\text{ not replaced at time }j]=1-\dfrac 1j=\dfrac{j-1}j$

Thus:
$$P[a_i\in R_t]=\dfrac ki\cdot\dfrac i{i+1}\cdot\dfrac{i+1}{i+2}\cdot\ldots\cdot\dfrac{t-1}t=\dfrac kt$$
```
- - -

