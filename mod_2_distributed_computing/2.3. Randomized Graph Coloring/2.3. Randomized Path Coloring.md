## Randomized Distributed Algorithm
We consider the PN model, where the nodes do not have unique identifiers.
In a randomized distributed algorithm, or randomized PN algorithm each node has access to its own random number generator, so it samples random numbers independently of other nodes.
Let $n=|V|$.
### Monte Carlo algorithms
Monte Carlo algorithm with running time $T(n)$ and probability $p$:
- always stops in time at most $T(n)$
- the output is correct with probability at least $p$
### Las Vegas algorithms
Las Vegas algorithm with running time $T(n)$ and probability $p$:
- stops in time at most $T(n)$ with probability at least $p$
- the output is always correct

We will focus on Las Vegas algorithms in the following.
### High probability bound
A Las Vegas algorithm is said to stop in time $O(T(n))$ with high probability (w.h.p.) if the probability $p$ is of the form:
$$p=1-\dfrac1{n^c}$$
for any chosen constant $c>0$.
The constant hidden in $O(T(n))$ depends on $c$.
Here, "time" means "number of rounds".
- - -
## Randomized coloring in bounded-degree graph
### Problem definition
Given an $n$-node graph $G$ of max-degree $\Delta$, output a $(\Delta+1)$-coloring in $G$.
```ad-Esempio
title: Example
Example with $\Delta=3$:
![[Random coloring in bounded-degree graph.png]]
```
We will present a Las Vegas distributed algorithm running in $O(\log(n))$ rounds w.h.p.
### Naive algorithm
Algorithm for a node $u$:
- pick a color $c(u)$ uniformly at random from $\{1,\ldots,\Delta+1\}$
- send $c(u)$ to neighbors
- if $c(u)$ conflicts with colors received by neighbors, repeat
- otherwise, keep $c(u)$ and stop

This is the algorithm for paths where $\Delta=2$ which stopped in $O(\log(n))$ rounds w.h.p.
For larger values of $\Delta$, though, the naive version will be too slow.
### Refined algorithm
#### State
Define the color palette $u\in V$ as:
$$C(u)=\{1,2,\ldots,\deg_G(u)+1\}$$
where $\deg_G(u)$ is the degree of $u$:
![[Refined algorithm color palette.png]]
Each node maintains:
- state $s(u)\in\{0,1\}$
- color $c(u)\in\{\perp\}\cup C(u)$

We will interpret $c(u)=\perp$ as $u$ not having been assigned a color yet. At termination, the $c(u)$-colors will form a valid $(\Delta+1)$-coloring.
#### Algorithm (for each node)
At round $0$, we initialize $s(u)=1$ and $c(u)=\perp$.
$u$ sends $c(u)$ to its neighbors at the start of every following round. Until $u$ stops, it alternates between states $1$ and $0$:
- in odd rounds, $s(u)$ starts as $1$ and ends at $0$
- in even rounds, $s(u)$ starts as $0$ and ends at $1$

$u$ stops when $s(u)=1$ and $c(u)\ne\perp$.
$s(u)$ keeps track of the parity of rounds and if $u$ has stopped, but $u$ keep sending $c(u)$ to its neighbors even after stopping.
#### Odd rounds
In odd rounds, each node $u$:
- sends $c(u)$ to its neighbors
- assume that $u$ has not stopped, i.e., $c(u)=\perp$
- $M(u)$ are the messages (colors) received by the neighbors
- $F(u)=C(u)\smallsetminus M(u)$ are the free colors, currently not used by the neighbors
- with probability $\dfrac12$, pick $c(u)$ from $F(u)$ uniformly at random, otherwise stays $\perp$.
- switch state to $0$.

#### Even rounds
In even rounds, each node $u$:
- sends $c(u)$ to its neighbors
- $M(u)$ are the messages (colors) received by the neighbors
- if $c(u)\in M(u)$, i.e., a conflict, set $c(u)$ back to $\perp$
- switch state to $1$.

#### Correctness
$u$ stops at the end of an even round if both happens:
- it was assigned a color in the previous odd round
- there is no conflict in the current even round

And keeps its color once stopped. If a neighbor $v$ changes its color in an odd round after $u$ stopped:
- $u$ sends $c(u)$ to $v$ in that round, so $c(u)\in M(v)$
- $v$ then picks a color from $F(v)=C(v)\smallsetminus M(v)$, so $c(v)\ne c(u)$

Thus, if the algorithm terminates, it outputs a valid coloring.
Since each $c(u)\in C(u)=\{1,\ldots,\deg_G(u)+1\}$, the output is a $(\Delta+1)$-coloring.
#### Competitors in odd rounds
Let's define $K(u)$ as the competitors of $u$, i.e., the neighbors that have not stopped yet.
![[competitors.png]]
Competitors are the only ones that $u$ can have a color conflict with at the end of the round: all other neighbors have colors in $M(u)$ which are not in $F(u)$.
#### Proof sketch
In an odd round, assume $u$ picks a color.
We expect only half the competitors of $u$ to also pick a color.
Thus, at least half of the free colors for $u$ should not give conflicts.
So, if $u$ picks a color with probability $\dfrac12$, it should have no conflicts with probability at least $\dfrac12$.
We therefore expect at least $\dfrac14$ of the nodes $u$ to stop at the end of each even round
If this occurs, the algorithm stops after $O(\log(n))$ rounds.
We will now formally prove that it stops in $O(\log(n))$ rounds w.h.p.
#### Number of free colors
Consider the beginning of an odd round.
Let $k=|K(u)|$ be the number of competitors of $u$.
We have $c(u)=\perp$ for each $v\in K(u)$.
$M_\text{col}(u)=M(u)\smallsetminus\{\perp\}$, thus has $\le\deg_G(u)-k$ distinct colors.
![[Number of colors.png]]
Letting $f=|F(u)|$, we then get:
$$\begin{align}
f&=|C(u)\smallsetminus M(u)|\\
&=|C(u)\smallsetminus M_\text{col}(u)|\\
&\ge|C(u)|-|M_\text{col}(u)|\\
&=(\deg_G(u)+1)-|M_\text{col}(u)|\\
&\ge(\deg_G(u)+1)-(\deg_G(u)-k)\\
&=k+1
\end{align}$$
#### Probability of conflict in an odd round
We have shown that the number of free colors is $f\ge k+1$.
We consider what happens at the end of an odd round.
Let $v$ be a competitor of $u$ and assume $u$ picks a color, i.e., $c(u)\ne\perp$.
The probability of a conflict conditioned on $v$ also picking a color is:
$$P[c(u)=c(v)|c(u),c(v)\ne\perp]\le\dfrac1f$$
This follows since at most $1$ of the $f$ choices for $u$ gives a conflict.
Since $v$ picks a color with probability $\dfrac12$:
$$P[c(u)=c(v)|c(u)\ne\perp]=P[c(u)=c(v)|c(u),c(v)\ne\perp]\cdot P[c(v)\ne\perp]\le\dfrac1f\cdot P[c(v)\ne\perp]=\dfrac1{2f}$$
Since $f\ge k+1$, a union bound shows that the probability of a conflict between $u$ and at least one competitor $v$ is:
$$P\left[\bigcup_{v\in K(u)}\{c(u)=c(v)|c(u)\ne\perp\}\right]\le\dfrac{k}{2f}\le\dfrac{k}{2(k+1)}<\dfrac12$$
We have shown that if $u$ picks a color, it is in conflict with at least one competitor with probability $<\dfrac12$.
Hence, if $u$ picks a color, it has no conflict with probability $>\dfrac12$.
The probability that $u$ picks a color is $\dfrac12$, so the probability that $u$ picks a color and has no conflicts is:
$$P[u\text{ has no conflicts }|c(u)\ne\perp]\cdot P[c(u)\ne\perp]>\dfrac12\cdot\dfrac12=\dfrac14$$
Recall that $u$ stops in the following even round if it picks a color which does not conflict with any competitor, which has probability of $>\dfrac14$.
#### Bounding the number of rounds
In every second round, $u$ stops with probability $>\dfrac14$.
The probability that $u$ has not stopped after $t\in\{2,4,\ldots\}$ rounds is less than:
$$\left(1-\dfrac14\right)^{t/2}=\left(\dfrac34\right)^{t/2}$$
By a union bound over all $u\in V$, the probability that the algorithm has not stopped after $t$ rounds is less than:
$$n\left(\dfrac34\right)^{t/2}$$
We pick $t$ so that this is $n^{-c}$ for constant $c>0$:
$$\begin{align}
n\left(\dfrac34\right)^{t/2}&=n^{-c}\iff\\
\left(\dfrac43\right)^{t/2}&=n^{c+1}\iff\\
t&=2(c+1)\log_{4/3}(n)
\end{align}$$
We have shown that the probability that the algorithm doesn't stop within:
$$t=2(c+1)\log_{4/3}(n)$$
rounds is less than $n^{-c}$.
Thus, the algorithm runs in $O(\log(n))$ time w.h.p.
- - -